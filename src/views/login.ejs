<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Sign-in</title>
    <link rel="stylesheet" href="./css/login.css">
  </head>
  <body>
    <div class="login-card">
      <h1><%= title %></h1>
      <% if (flash) { %>
        <p><%= flash %></p>
      <% } %>
      <!-- <form autocomplete="off" action="/interaction/<%= uid %>/login" method="post">
        <input required type="email" name="email" placeholder="Enter an email" <% if (!params.login_hint) { %>autofocus="on"<% } else { %> value="<%= params.login_hint %>" <% } %>>
        <input required type="password" name="password" placeholder="and password" <% if (params.login_hint) { %>autofocus="on"<% } %>>

        <button type="submit" class="login login-submit">Sign-in</button>
      </form> -->

      <script
        async
        src="https://telegram.org/js/telegram-widget.js?22"
        data-telegram-login="nestjs_login_bot"
        data-size="large"
        data-onauth="onTelegramAuth(user)"
        data-request-access="write"
    ></script>

    <script type="text/javascript">
      async function onTelegramAuth(user) {
        try {
            const response = await fetch('https://app2.skyvn.top/interaction/<%= uid %>/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            });

            window.location.href = response.url;
            

        } catch (error) {
            console.error('Fetch error:', error);
        }
      }
    </script>
  </body>
</html>